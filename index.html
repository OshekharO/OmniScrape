<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OmniScrape: Multi-Website Search Tool | Uncoder.eu.org</title>
    <meta name="description" content="OmniScrape by Uncoder.eu.org is a powerful multi-search website scraper. Search across multiple websites simultaneously for efficient content discovery." />
    <meta name="keywords" content="OmniScrape, website scraper, multi-search tool, web search, content discovery, Uncoder.eu.org" />
    <link rel="canonical" href="https://uncoder.eu.org/omniscrape/" />
    <meta name="robots" content="index, follow" />
    <meta name="author" content="OshekharO" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://uncoder.eu.org/omniscrape/" />
    <meta property="og:title" content="OmniScrape: Multi-Website Search Tool" />
    <meta property="og:description" content="Discover content across multiple websites simultaneously with OmniScrape, the powerful multi-search tool by Uncoder.eu.org." />
    <meta property="og:image" content="https://uncoder.eu.org/images/omniscrape-og.jpg" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://uncoder.eu.org/omniscrape/" />
    <meta property="twitter:title" content="OmniScrape: Multi-Website Search Tool" />
    <meta property="twitter:description" content="Discover content across multiple websites simultaneously with OmniScrape, the powerful multi-search tool by Uncoder.eu.org." />
    <meta property="twitter:image" content="https://uncoder.eu.org/images/omniscrape-twitter.jpg" />

    <meta name="copyright" content="Copyright Â© 2024 OshekharO" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
      body {
        font-family: Inter, sans-serif;
        font-weight: 300;
        font-size: 14px;
        line-height: 1.6;
        color: #616370;
        background: #26272c;
        height: 100%;
        margin: 2.5rem;
      }
      .container {
        max-width: 900px;
      }
      .alert {
        background-color: #454d55;
        border: none;
        color: #fff;
      }
      .alert-success {
        background-color: #28a745;
      }
      .alert-warning {
        background-color: #ffc107;
        color: #000;
      }
      .alert-danger {
        background-color: #dc3545;
      }
      #loading {
        margin: 2rem 0;
      }
      .card img {
        object-fit: cover;
        height: 250px;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <h1 class="fs-2 fw-bold mb-4 text-uppercase text-center text-light">OmniScrape</h1>

      <div class="row justify-content-center mb-3">
        <div class="col-md-8">
          <div class="mb-3">
            <label for="categorySelect" class="form-label fs-7 font-monospace badge bg-danger text-light">Category</label>
            <select id="categorySelect" class="form-select mb-3">
              <option value="all">All Categories</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="searchInput" class="form-label fs-7 font-monospace badge bg-danger text-light">Search Term</label>
            <input type="text" class="form-control" id="searchInput" placeholder="Enter search term" required />
          </div>
          <button id="searchButton" class="btn btn-primary mb-3">Search</button>
          <div id="loading" class="text-center text-light d-none">
            <div class="spinner-border text-danger" role="status"></div>
            <p>Fetching results...</p>
          </div>
          <div id="results" class="mt-4"></div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script>
      let websites = {};
      const corsBypassUrl = "https://cors-bypasser-gilt.vercel.app/fetchdata?url=";

      $(document).ready(function () {
        // Load sites.json
        $.getJSON("sites.json", function (data) {
          websites = data;
          populateCategorySelect();
        }).fail(function () {
          alert("Failed to load site configuration.");
        });

        $("#searchButton").click(function () {
          const searchTerm = $("#searchInput").val().trim();
          const category = $("#categorySelect").val();

          if (!searchTerm) {
            alert("Please enter a search term!");
            return;
          }

          searchWebsites(searchTerm, category);
        });
      });

      // Populate category dropdown
      function populateCategorySelect() {
        const select = $("#categorySelect");
        Object.keys(websites).forEach((category) => {
          select.append(
            $("<option>", {
              value: category,
              text: category.replace(/\b\w/g, (c) => c.toUpperCase()),
            })
          );
        });
      }

      // Main search function with batching
      function searchWebsites(searchTerm, category) {
        $("#results").empty();
        $("#loading").removeClass("d-none");

        const categoriesToSearch = category === "all" ? Object.keys(websites) : [category];
        const promises = [];

        categoriesToSearch.forEach((cat) => {
          Object.values(websites[cat]).forEach((website) => {
            const searchUrl = website.url + encodeURIComponent(searchTerm);
            const bypassUrl = corsBypassUrl + encodeURIComponent(searchUrl);

            const request = $.ajax({
              url: bypassUrl,
              method: "GET",
            })
              .then((data) => ({ website, data }))
              .catch((err) => ({ website, data: null, error: err }));

            promises.push(request);
          });
        });

        // Wait for all requests to finish
        Promise.all(promises).then((results) => {
          results.forEach((res) => {
            if (res.data) {
              const parsed = parseResults(res.data, res.website);
              displayResults(res.website.name, parsed);
            } else {
              displayResults(res.website.name, []);
              $("#results").append(`<p class="alert alert-danger">Failed to fetch from ${res.website.name}</p>`);
            }
          });

          $("#loading").addClass("d-none");
        });
      }

      // Parse HTML response
      function parseResults(html, website) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, "text/html");
        const results = [];

        const items = doc.querySelectorAll(website.main);
        items.forEach((item) => {
          const titleElement = item.querySelector(website.title);
          const imgElement = item.querySelector(website.img);
          const hrefElement = item.querySelector(website.href);

          if (titleElement && hrefElement) {
            let imgSrc = imgElement?.getAttribute("src") || imgElement?.getAttribute("data-src") || imgElement?.getAttribute("data-original") || "https://via.placeholder.com/300x400?text=No+Image";
            let href = hrefElement.getAttribute("href");

            if (href && !href.startsWith("http")) href = website.baseUrl + (href.startsWith("/") ? "" : "/") + href;
            if (imgSrc && !imgSrc.startsWith("http")) imgSrc = website.baseUrl + (imgSrc.startsWith("/") ? "" : "/") + imgSrc;

            results.push({
              title: titleElement.textContent.trim(),
              img: imgSrc,
              href: href,
            });
          }
        });

        return results;
      }

      // Display results
      function displayResults(websiteName, results) {
        const resultsContainer = $("#results");
        const websiteResults = $(`<section class="mb-4"><h2 class="text-light">${websiteName}</h2></section>`);

        if (!results.length) {
          websiteResults.append('<p class="alert alert-warning">No results found.</p>');
        } else {
          const row = $('<div class="row"></div>');
          results.forEach((result) => {
            const col = $(`
        <div class="col-md-4 mb-3">
          <div class="card bg-dark text-light border-danger h-100">
            <img src="${result.img}" class="card-img-top" alt="${result.title}" loading="lazy">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">${result.title}</h5>
              <a href="${result.href}" class="btn btn-primary mt-auto" target="_blank">View</a>
            </div>
          </div>
        </div>
      `);
            row.append(col);
          });
          websiteResults.append(row);
        }

        resultsContainer.append(websiteResults);
      }
    </script>
  </body>
</html>
